<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>饮食文化</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/icons-extra.css" />

		<style>
			.mui-segmented-control {
				width: 100%;
			}
			
			.mui-segmented-control .mui-control-item.mui-active {
				color: #fff;
				background-color: #21a900;
			}
			
			.mui-segmented-control .li {
				display: inline-block;
				width: 23%;
				margin-right: 5px;
				border-radius: 15px;
				border: 1px solid #ccc;
				height: 30px;
				line-height: 30px;
				font-size: 14px;
			}
			
			.main_des {
				font-size: 0.75rem;
				line-height: 20px;
				color: #9B9B9B;
			}
			
			.mui-table-view-cell .mui-ellipsis {
				color: #000;
				font-size: 0.85rem;
				margin-bottom: 5px;
			}
			
			.mui-table-view .mui-media-object {
				height: 80px;
				max-width: 80px;
			}
			
			.mui-table-view:after {
				height: 0;
			}
			
			.mui-table-view-cell:after {
				height: 0;
			}
			
			.mui-table-view-cell {
				padding-bottom: 5px;
				border-bottom: 1px solid #D8D8D8;
			}
			
			.date {
				font-size: 0.8rem;
			}
			
			.mui-table-view:before {
				height: 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">饮食文化</h1>
		</header>

		<div class="mui-content">
			<div style="padding-top:20px;padding-left:10px">
				<div id="segmentedControl" class="mui-segmented-control">
					<!--<a class="mui-control-item mui-active li" href="#item1">
						营养指南
					</a>
					<a class="mui-control-item li" href="#item1">
						饮食资讯
					</a>
					<a class="mui-control-item li" href="#item1">
						食疗养生
					</a>-->
				</div>
			</div>
			<div>
				<div id="item1" class="mui-control-content mui-active">

					<ul class="mui-table-view" id="ulList">

						<!--<li class="mui-table-view-cell">

							<div class="dmain">
								<ul class="mui-table-view ml">

									<li class="mui-table-view-cell mui-media myli">
										<a href="zixiang.html">
											<img class="mui-media-object mui-pull-left" src="images/z3.png">
											<div class="mui-media-body">
												<p class="mui-ellipsis">辉山高钙奶陷质量风波：被检硫氰酸钠超标</p>
												<p class='main_des'>日前, 辽宁辉山乳业高钙奶被河北省食品药监局检
													<br>测出硫氰酸钠超标...</p>
											</div>
											<div class="mui-pull-right">
												<p class='date'>2017-03-22</p>
											</div>
										</a>
									</li>

								</ul>
							</div>

						</li>-->

					</ul>

				</div>

			</div>

		</div>

		<!--分页-->
		<div class="mui-content-padded mui-text-center" style="height: 100px;">
			<ul class="mui-pagination mui-pagination-sm" id="dvpager" style="padding-top: 15px;">
	
			</ul>
		</div>

		<!--footer-->
		<nav class="mui-bar mui-bar-tab bottom">
			<a data-id='index.html' class="mui-tab-item mui-active">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a data-id='cate.html' class="mui-tab-item">
				<span class="mui-icon mui-icon-extra mui-icon-extra-class"></span>
				<span class="mui-tab-label">分类</span>
			</a>
			<a data-id='culture.html' class="mui-tab-item">
				<span class="mui-icon mui-icon-chatboxes"></span>
				<span class="mui-tab-label">资讯</span>
			</a>
			<a data-id='shopcar.html' class="mui-tab-item">
				<span class="mui-icon mui-icon-extra mui-icon-extra-cart"></span>
				<span class="mui-tab-label">购物车</span>
			</a>
			<a data-id='member.html' class="mui-tab-item">
				<span class="mui-icon mui-icon-person"></span>
				<span class="mui-tab-label">我的</span>
			</a>
		</nav>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript" src="js/laypage.js" ></script>
		<script type="text/javascript">
			(function($, doc) {
				var myPlus,activeTab = 'culture.html';
				$.init({
					beforeback:function(){
						var self = plus.webview.currentWebview();
						var intrance = self.extras.intrance||'index.html';
						app.preateHide(intrance,self.extras);
						return true;
					}
				});
			
				$.plusReady(function() {
					myPlus = plus;
					app.MenuInit(activeTab);
					loadData();
				});
				
				window.addEventListener('show', function() {
					loadData();
				}, false);
				
				//加载数据
				var loadData = function() {
					if(!myPlus) {
						$.plusReady(function() {
							myPlus = plus;
							app.MenuInit(activeTab);
							loadData();
						});
						
						return;
					}

					var $state = app.getState();
					var serverUrl = app.getServerUrl();

					var initCategory = function(response) {
						if(response.status == true && response.data) {
							// 信息
							var dvsegmentedControl = document.getElementById("segmentedControl");
							dvsegmentedControl.innerHTML = '';
							
							for(var i =0;i < response.data.length;i++){
								var a =  document.createElement("a"); 
								a.className='mui-control-item '+(i===0 ? 'mui-active':'')+' li';
								a.setAttribute('href','item1');
								a.innerHTML=response.data[i];								
								dvsegmentedControl.appendChild(a);
							}
							// 注册事件
							$('#segmentedControl').on('tap','a',function(){
								var newstype = this.innerHTML;
								loadPages(1,15,newstype);
							});
							loadPages(1,15,doc.querySelector('a.mui-active').innerHTML);
						} else {
							mui.toast('查询饮食文化错误！');
						}
					};
					// 连接服务器
					mui.ajax(serverUrl + "/api/MallBase/GetFoodCultureType", {
						data: {

						},
						dataType: 'json', //服务器返回json格式数据
						type: 'get', //HTTP请求类型
						timeout: 10000, //超时时间设置为10秒；
						success: initCategory,
						error: function(xhr, type, errorThrown) {
							console.log(errorThrown);
							myPlus.nativeUI.toast('获取资讯信息失败');
						}
					});
				};
				// 分页加载资讯
				var loadPages = function(pageIndex, pageSize,newstype){
					var initList = function(response){
						var ulList = doc.getElementById("ulList");
						ulList.innerHTML = '';
						if(response.status && response.data){
							var list = response.data.list;
							if(response.data.totalRows > 0){
								for(var i = 0; i< list.length; i++){
									var li = doc.createElement('li');
									li.className='mui-table-view-cell';				
								
									var html = '<div class="dmain"><ul class="mui-table-view ml"><li class="mui-table-view-cell mui-media myli">';
									html +='<a href="javascript:void(0);" data-id="'+list[i].id+'"><img class="mui-media-object mui-pull-left" src="' + app.getServerUrl()+list[i].imgPath +'">';
									html +='<div class="mui-media-body"><p class="mui-ellipsis">' + list[i].newsTitle + '</p></div>';
									html +='<div class="mui-pull-right"><p class="date">' + list[i].issueDate.split('T')[0] +'</p></div></a></li></ul></div>';

									li.innerHTML=html;
									ulList.appendChild(li);
								}
								// 加载分页
								laypage({
								    cont: 'dvpager',
								    curr:pageIndex,
								    pages: response.data.totalPages,
								    groups:1,
								    first:false,
								    last:false,
								    skin: '#21a900',
								    jump: function(obj,first){
								    	if(!first){
								        	loadPages(obj.curr,15,newstype);
								    	}
								    }
								});
								// 注册事件
								$('.myli').on('tap','a', function(){
									var newsId = this.getAttribute('data-id');
									app.preateHide('culture_detail.html',{newsId:newsId});
								});
							}
						}
					};
					// 连接服务器
					mui.ajax(app.getServerUrl() + "/api/MallBase/GetFoodCulturePages", {
						data: {
							pageIndex:pageIndex || 1,
							pageSize :pageSize || 15,
							newstype:newstype
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'get', //HTTP请求类型
						timeout: 10000, //超时时间设置为10秒；
						success: initList,
						error: function(xhr, type, errorThrown) {
							console.log(errorThrown);
							myPlus.nativeUI.toast('获取资讯信息失败');
						}
					});
				};
				


			}(mui, document));
		</script>
	</body>

</html>